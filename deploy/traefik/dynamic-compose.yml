# Traefik Dynamic Configuration for Docker Compose
# Services use Docker network DNS names (container names)

http:
  routers:
    # Thumbnails - direct MinIO access
    thumbnails-router:
      rule: "PathPrefix(`/thumbnails`)"
      service: minio-thumbnails
      entryPoints:
        - web
      priority: 120

    # API Swagger UI
    api-swagger-router:
      rule: "PathPrefix(`/api/swagger`)"
      service: api
      entryPoints:
        - web
      priority: 110

    # SignalR WebSocket hubs
    hubs-router:
      rule: "PathPrefix(`/hubs`)"
      service: api
      entryPoints:
        - web
      priority: 105

    # API endpoints
    api-router:
      rule: "PathPrefix(`/api`)"
      service: api
      entryPoints:
        - web
      priority: 100

    # Web UI (catch-all)
    web-router:
      rule: "PathPrefix(`/`)"
      service: web
      entryPoints:
        - web
      priority: 1

  services:
    minio-thumbnails:
      loadBalancer:
        servers:
          - url: "http://minio:9000"

    api:
      loadBalancer:
        servers:
          - url: "http://api:8080"

    web:
      loadBalancer:
        servers:
          - url: "http://web:80"
