# Traefik Dynamic Configuration for Podman/Kubernetes
# Services use localhost since all containers run in the same pod

http:
  routers:
    # Thumbnails - direct MinIO access
    thumbnails-router:
      rule: "PathPrefix(`/thumbnails`)"
      service: minio-thumbnails
      entryPoints:
        - web
      priority: 120

    # API Swagger UI
    api-swagger-router:
      rule: "PathPrefix(`/api/swagger`)"
      service: api
      entryPoints:
        - web
      priority: 110

    # SignalR WebSocket hubs
    hubs-router:
      rule: "PathPrefix(`/hubs`)"
      service: api
      entryPoints:
        - web
      priority: 105

    # API endpoints
    api-router:
      rule: "PathPrefix(`/api`)"
      service: api
      entryPoints:
        - web
      priority: 100

    # Web UI (catch-all)
    web-router:
      rule: "PathPrefix(`/`)"
      service: web
      entryPoints:
        - web
      priority: 1

  services:
    minio-thumbnails:
      loadBalancer:
        servers:
          - url: "http://localhost:9000"

    api:
      loadBalancer:
        servers:
          - url: "http://localhost:5080"

    web:
      loadBalancer:
        servers:
          # nginx in web container listens on port 80, mapped to 8090 in pod
          - url: "http://localhost:8090"
