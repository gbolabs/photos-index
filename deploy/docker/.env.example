# Photos Index - Docker Compose Environment Variables
# Copy this file to .env and customize values for your deployment

# ===================================
# PostgreSQL Database Configuration
# ===================================

# PostgreSQL version: 16-alpine
POSTGRES_USER=photosuser
POSTGRES_PASSWORD=changeme_secure_password
POSTGRES_DB=photosindex

# Host port for PostgreSQL (exposed for development/tools)
# Default: 5432 (maps to container port 5432)
POSTGRES_PORT=5432

# ===================================
# Aspire Dashboard Configuration
# ===================================

# Aspire Dashboard UI port (web interface for logs, traces, metrics)
# Default: 18888
# Access dashboard at: http://localhost:18888
ASPIRE_DASHBOARD_PORT=18888

# OTLP gRPC endpoint port (internal use by services)
# Default: 4317 (maps to container port 18889)
ASPIRE_OTLP_PORT=4317

# ===================================
# API Service Configuration
# ===================================

# ASP.NET Core environment (Development, Staging, Production)
# Development: Enables detailed errors, Swagger, etc.
# Production: Optimized for performance and security
ASPNETCORE_ENVIRONMENT=Production

# Host port for API service
# Default: 5000 (maps to container port 8080)
# Access API at: http://localhost:5000
API_PORT=5000

# API version (used for OpenTelemetry resource attributes)
API_VERSION=1.0.0

# ===================================
# Indexing Service Configuration
# ===================================

# Path to photos directory on host machine
# This directory will be mounted read-only into the indexing container
# Example: /volume1/photos (Synology NAS)
# Example: /mnt/photos (Linux)
# Example: ./photos (relative path for testing)
HOST_PHOTOS_DIRECTORY=./photos

# Path to photos directory inside containers
# Default: /photos (do not change unless you know what you're doing)
PHOTOS_DIRECTORY=/photos

# Indexing interval in minutes
# How often the indexing service scans for new/changed files
# Default: 60 (1 hour)
INDEXING_INTERVAL_MINUTES=60

# Indexing service version
INDEXING_VERSION=1.0.0

# ===================================
# Cleaner Service Configuration
# ===================================

# Enable/disable the cleaner service
# IMPORTANT: Set to 'false' for safety until you're ready to delete files
# Default: false
CLEANER_ENABLED=false

# Path to trash directory for soft-deleted files
# Files will be moved here before permanent deletion
# Default: /photos/.trash (subdirectory of photos)
TRASH_DIRECTORY=/photos/.trash

# Cleaner service version
CLEANER_VERSION=1.0.0

# ===================================
# Traefik Reverse Proxy Configuration
# ===================================

# HTTP port for Traefik (main entry point)
# Default: 80
# Access application at: http://localhost
TRAEFIK_HTTP_PORT=80

# HTTPS port for Traefik (when SSL enabled)
# Default: 443
TRAEFIK_HTTPS_PORT=443

# Traefik dashboard port
# Default: 8080
# Access dashboard at: http://localhost:8080
TRAEFIK_DASHBOARD_PORT=8080

# Allow insecure dashboard access (set to false in production)
TRAEFIK_DASHBOARD_INSECURE=true

# Traefik log level (DEBUG, INFO, WARN, ERROR)
TRAEFIK_LOG_LEVEL=INFO

# Enable access logging
TRAEFIK_ACCESS_LOG=false

# OpenTelemetry trace sample rate (0.0 to 1.0)
# 1.0 = trace all requests, 0.1 = trace 10% of requests
TRAEFIK_TRACE_SAMPLE_RATE=1.0

# Email for Let's Encrypt certificates (required for SSL)
# ACME_EMAIL=admin@example.com

# ===================================
# Web Interface Configuration
# ===================================

# Host port for web interface (direct access, bypassing Traefik)
# Default: 4200 (maps to container port 80)
# Access web UI at: http://localhost:4200
# Note: When using Traefik, access via http://localhost instead
WEB_PORT=4200

# API URL for web interface
# When using Traefik: /api (relative URL, recommended)
# For direct access: http://localhost:5000
API_URL=/api

# ===================================
# Advanced Configuration
# ===================================

# Docker network configuration
# The services communicate over a bridge network named 'photos-network'
# No configuration needed unless you have conflicts

# Volume configuration
# Named volumes for persistent data:
# - postgres_data: PostgreSQL database files
# - indexing_thumbnails: Generated thumbnail images
# - cleaner_logs: Cleaner service transaction logs

# Resource limits (optional - uncomment in docker-compose.yml)
# You can add resource limits for each service if running on constrained hardware:
# deploy:
#   resources:
#     limits:
#       cpus: '1.0'
#       memory: 512M
#     reservations:
#       memory: 256M

# ===================================
# Synology NAS Specific Notes
# ===================================

# 1. Set HOST_PHOTOS_DIRECTORY to your actual photo directory:
#    Example: /volume1/photos or /volume2/family-photos

# 2. For production, use a strong POSTGRES_PASSWORD

# 3. Set ASPNETCORE_ENVIRONMENT=Production for better performance

# 4. Consider setting INDEXING_INTERVAL_MINUTES based on how often
#    you add new photos (e.g., 1440 for once daily)

# 5. Keep CLEANER_ENABLED=false until you've verified the duplicate
#    detection works correctly for your photo library

# 6. If accessing from outside your local network, set API_URL to
#    your NAS's external URL or IP address

# ===================================
# Security Recommendations
# ===================================

# 1. Change default passwords (especially POSTGRES_PASSWORD)
# 2. Use strong, unique passwords
# 3. Do not commit .env file to version control (it's in .gitignore)
# 4. For production deployments, consider using Docker secrets
# 5. Enable HTTPS with a reverse proxy (nginx, Traefik) for external access
# 6. Regularly update Docker images for security patches

# ===================================
# Troubleshooting
# ===================================

# View logs: docker compose logs -f [service-name]
# Restart service: docker compose restart [service-name]
# Rebuild service: docker compose up -d --build [service-name]
# Stop all: docker compose down
# Clean slate: docker compose down -v (WARNING: deletes all data)

# Access Aspire Dashboard for observability:
# http://localhost:18888 (view logs, traces, metrics from all services)
